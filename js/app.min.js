(function(){"use scrict";function M(){O.history({channel:A,count:100,callback:function(e){O.each(e[0],j);_()},error:function(e){if(e){_()}}})}function _(){O.subscribe({channel:A,callback:j})}function D(e,t){if(!e.geo)return;var n={};n.lat=e.geo.coordinates[0];n.lon=e.geo.coordinates[1];if(n.lat===0&&n.lon===0)return;var r=e.place.full_name;n.city=r;n.state=r.substring(r.lastIndexOf(",")+1).trim();n.name=e.user.name;n.screenname=e.user.screen_name;n.avatar=e.user.profile_image_url;n.tweet=e.text;n.id_str=e.id_str;var i=new Date(parseInt(e.timestamp_ms));var s=i.toDateString().substr(4);var o=i.getHours()>12?i.getHours()-12+":"+i.getMinutes()+" PM":i.getHours()+":"+i.getMinutes()+" AM;";n.timestamp=o+" - "+s;t(n)}function P(e){return e.replace(/((https?|s?ftp|ssh)\:\/\/[^"\s\<\>]*[^.,;'">\:\s\<\>\)\]\!])/g,function(e){return'<a href="'+e+'" >'+e+"</a>"})}function H(e){e=e.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"");if(e==="brasil")return;states={acre:"AC",alagoas:"AL",amap:"AP",amazonas:"AM",bahia:"BA",cear:"CE","distrito-federal":"DF","esprito-santo":"ES",gois:"GO",maranho:"MA","mato-grosso":"MT","mato-grosso-do-sul":"MS","minas-gerais":"MG",par:"PA",paraba:"PB",paran:"PR",pernambuco:"PE",piau:"PI","rio-de-janeiro":"RJ","rio-grande-do-norte":"RN","rio-grande-do-sul":"RS",rondnia:"RO",roraima:"RR","santa-catarina":"SC","so-paulo":"SP",sergipe:"SE",tocantins:"TO"};return states[e]}function B(e,t){D(e,function(e){document.querySelector(".emotion").style.backgroundImage="url(images/"+t.icon+")";document.querySelector(".button").href="https://twitter.com/"+e.screenname;document.querySelector(".header").style.backgroundImage="url("+e.avatar+")";document.querySelector(".name").textContent=e.name;document.querySelector(".screenname").textContent="@"+e.screenname;document.querySelector(".text").innerHTML=twemoji.parse(P(e.tweet));document.querySelector(".timestamp").textContent=e.timestamp;document.querySelector(".reply").href="https://twitter.com/intent/tweet?in_reply_to="+e.id_str;document.querySelector(".retweet").href="https://twitter.com/intent/retweet?tweet_id="+e.id_str;document.querySelector(".favorite").href="https://twitter.com/intent/favorite?tweet_id="+e.id_str;document.querySelector(".tweet").style.opacity=.9;var o=H(e.state);if(o&&document.querySelector("."+o)){n[e.state]=n[e.state]||{positive:0,negative:0};n[e.state][t.type]=(n[e.state][t.type]||0)+1;var u=document.querySelector("."+o);u.style.fill=n[e.state].positive>n[e.state].negative?i:n[e.state].positive<n[e.state].negative?r:s;u.setAttribute("data-positive",n[e.state].positive);u.setAttribute("data-negative",n[e.state].negative)}var a=C([e.lon,e.lat]);if(a===null)return;L.enter().append("svg:image").attr("xlink:href","images/"+t.icon).attr("width","26").attr("height","26").attr("transform",function(e){return"translate("+a+")"})})}function j(e){if(!e||!e.place||!e.lang)return;if(e.place.country_code!=="BR")return;if(p.some(function(t){return e.text.toLowerCase().indexOf(t)>0})){B(e,o)}else if(d.some(function(t){return e.text.toLowerCase().indexOf(t)>0})){B(e,u)}else if(v.some(function(t){return e.text.toLowerCase().indexOf(t)>0})){B(e,a)}else if(m.some(function(t){return e.text.toLowerCase().indexOf(t)>0})){B(e,f)}else if(g.some(function(t){return e.text.toLowerCase().indexOf(t)>0})){B(e,l)}else if(y.some(function(t){return e.text.toLowerCase().indexOf(t)>0})){B(e,c)}else if(b.some(function(t){return e.text.toLowerCase().indexOf(t)>0})){B(e,h)}}var e=true;var t=document.getElementById("toggle");t.addEventListener("click",function(n){if(e){O.unsubscribe({channel:A});t.value="Continuar";e=false}else{M();t.value="Pausar";e=true}},false);var n={};var r="#FF8586";var i="#63A69F";var s="#DECEB3";var o={type:"positive",icon:"grinning-face.png"};var u={type:"positive",icon:"smiling-face.png"};var a={type:"positive",icon:"heart-eyed-happy-face.png"};var f={type:"negative",icon:"pensive-face.png"};var l={type:"negative",icon:"crying-face.png"};var c={type:"negative",icon:"angry-face.png"};var h={type:"negative",icon:"sick-face.png"};var p=["excelente","sensacional","lindo","irado","magnífico","fabuloso","fantástico","pacífico","brilhante","glorioso","gracioso","esplêndido","honrável","inspirável","virtuouso","orgulhoso","maravilhoso","amável"];var d=["feliz","sorte","animado","legal","aproveite","abençoado",":-)",":)",":-D",":D","=)","☺"];var v=["amor","adoro","amando","amável","querida","casado","noivo","noiva","casada","sensa","lindo"];var m=["infeliz","ruim","desculpe","noiado","não curto","ansioso","envergonhado","quebrado","bosta","maldoso","horrível","entediado","tédio","queimado","caótico","derrotado","devastado","estressado","desconectado","desencorajado","desonesto","embaraçado","louco","frustrado","estúpido","culpado","sem esperança","horrível","humilhado","ignorante","desumano","cruel","insano","inseguro","nervoso","ofendido","oprimido","patético","pobre","ferrado","sqn"];var g=["triste","sozinho","ansioso","deprimido","desapontado","desapontador","aff","chorando","chorei","sozinho","cabisbaixo","sensível","sem esperança","ferido","miserável","ninguém entende","suicida",":-(",":(","=(",";("];var y=["ódio","merda","raiva","traído","nojo","perturbado","furioso","assediado","odioso","hostil","insultado","irritável","ciúme","puto","irado"];var b=["doente","sem clima","vomitei","vomitando","vômito","vomitando","dor","ressaca","chapado"];var w=800;var E=700;var S=d3.scale.linear().domain([0,15]).range(["#5b5858","#4f4d4d","#454444","#323131"]);var x=d3.select("#map").append("svg").attr("width",w).attr("height",E);var T=x.append("g");var N=900;var C=d3.geo.mercator().center([-50,-10]).scale(N);var k=d3.geo.path().projection(C);d3.json("json/br-states.json",function(e,t){var n=topojson.feature(t,t.objects.states);T.selectAll("path").data(n.features).enter().append("path").attr("class",function(e){return"states "+e.properties.name}).attr("d",k).attr("fill",function(e,t){return S(t)})});var L=x.selectAll("image").data([0]);var A="pubnub-twitter";var O=PUBNUB.init({subscribe_key:"sub-c-78806dd4-42a6-11e4-aed8-02ee2ddab7fe"});M()})()
